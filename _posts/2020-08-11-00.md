---
layout: post
title: PHP 9 - Laravel Blog Website (CMS)
published_at: "2020-08-11"
updated_at: "2020-08-11"
author: Sheldon L
tags: [PHP, Laravel, Blog, CMS]
---

## Featurs

- CMS for admin

## Create Project

```bash
laravel new blog
cd blog

# set database in .env

composer require laravel/ui --dev
php artisan ui bootstrap --auth
npm install && npm run dev
```

## Schemas and Models

```bash
php artisan make:model Category -mcr
php artisan make:model Author -mcr
php artisan make:model Post -mcr
php artisan make:model Photo -mcr

php artisan make:model CategoryPost -m
php artisan make:model AuthorPost -m
php artisan make:model CategoryPhoto -m

php artisan make:controller PageController
```

```php
# categories table
$table->unsignedBigInteger('admin_id');
$table->foreign('admin_id')->references('id')->on('admins')->onDelete('cascade');

$table->string('thumbnail')->nullable();
$table->string('name')->unique();    # translatable
$table->string('slug')->unique();
$table->enum('is_published', ['0', '1']);
# Category
use HasTranslations;
protected $fillable = ['admin_id', 'thumbnail', 'name', 'slug', 'is_published'];
public $translatable = ['name'];
public function admin()
{
    return $this->belongsTo(Admin::class);
}
public function posts()
{
    return $this->belongsToMany(Post::class, 'category_posts');
}

# authors table
$table->unsignedBigInteger('admin_id');
$table->foreign('admin_id')->references('id')->on('admins')->onDelete('cascade');
$table->string('thumbnail')->nullable();
$table->string('name')->unique();    # translatable
$table->string('slug')->unique();
$table->text('intro')->nullable();   # translatable
$table->enum('is_published', ['0', '1']);
# Author
use HasTranslations;
protected $fillable = ['admin_id', 'thumbnail', 'name', 'slug', 'intro', 'is_published'];
public $translatable = ['name', 'intro'];
public function admin()
{
    return $this->belongsTo(Admin::class);
}
public function posts()
{
    return $this->belongsToMany(Post::class, 'author_posts');
}

# posts table
$table->unsignedBigInteger('admin_id');
$table->foreign('admin_id')->references('id')->on('admins')->onDelete('cascade');
$table->string('thumbnail')->nullable();
$table->string('title')->unique();        # translatable
$table->string('slug')->unique();
$table->string('sub_title')->nullable();  # translatable
$table->enum('is_reproduced', ['0', '1']);
$table->string('source')->nullable();
$table->text('source_url')->nullable();
$table->string('editor')->nullable();
$table->text('intro')->nullable();        # translatable
$table->text('details');                  # translatable
$table->string('post_type');
$table->enum('is_published', ['0', '1']);
# Post
use HasTranslations;
protected $fillable = [
    'admin_id', 'thumbnail', 'title', 'slug', 'sub_title',
    'is_reproduced', 'source', 'source_url', 'author', 'editor',
    'intro', 'details', 'post_type', 'is_published',
];
public $translatable = ['title', 'sub_title', 'intro', 'details'];
public function admin()
{
    return $this->belongsTo(Admin::class);
}
public function categories()
{
    return $this->belongsToMany(Category::class, 'category_posts');
}
public function authors()
{
    return $this->belongsToMany(Author::class, 'author_posts');
}

# category_posts table
$table->unsignedBigInteger('category_id');
$table->foreign('category_id')->references('id')->on('categories')->onDelete('cascade');
$table->unsignedBigInteger('post_id');
$table->foreign('post_id')->references('id')->on('posts')->onDelete('cascade');
# CategoryPost
protected $fillable = ['category_id', 'post_id'];

# author_posts table
$table->unsignedBigInteger('author_id');
$table->foreign('author_id')->references('id')->on('authors')->onDelete('cascade');
$table->unsignedBigInteger('post_id');
$table->foreign('post_id')->references('id')->on('posts')->onDelete('cascade');
# AuthorPost
protected $fillable = ['author_id', 'post_id'];

# photos table
$table->unsignedBigInteger('admin_id');
$table->foreign('admin_id')->references('id')->on('admins')->onDelete('cascade');
$table->string('image_url');
$table->text('intro')->nullable();    # translatable
$table->enum('is_published', ['0', '1']);
# Photo
use HasTranslations;
protected $fillable = ['admin_id', 'image_url', 'intro', 'is_published'];
public $translatable = ['intro'];
public function admin()
{
    return $this->belongsTo(Admin::class);
}
public function categories()
{
    return $this->belongsToMany(Category::class, 'category_photos');
}

# category_photos table
$table->unsignedBigInteger('category_id');
$table->foreign('category_id')->references('id')->on('categories')->onDelete('cascade');
$table->unsignedBigInteger('photo_id');
$table->foreign('photo_id')->references('id')->on('photos')->onDelete('cascade');
# CategoryPhoto
protected $fillable = ['subject_id', 'photo_id'];
```
    
```bash
php artisan migrate
```

### Seeder

```bash
composer require laravel/helpers
php artisan make:seeder CategoryTableSeeder
php artisan make:seeder AuthorTableSeeder
```

```php
# CategoryTableSeeder
public function run()
{
    Category::create([
        'admin_id' => '1',
        'name' => ['cn'=>'未分类', 'en'=>'uncategorized'],
        'slug' => 'uncategorized',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
    Category::create([
        'admin_id' => '1',
        'name' => ['cn'=>'南德理论', 'en'=>'Land Theory'],
        'slug' => 'land-theory',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
    Category::create([
        'admin_id' => '1',
        'name' => ['cn'=>'南德往事', 'en'=>'Land History'],
        'slug' => 'land-history',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
    Category::create([
        'admin_id' => '1',
        'name' => ['cn'=>'万尾鲨鱼苗', 'en'=>'Shark Pups'],
        'slug' => 'shark-pups',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
    Category::create([
        'admin_id' => '1',
        'name' => ['cn'=>'长江计划', 'en'=>'Yangtze Project'],
        'slug' => 'yangtze-project',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
}

# AuthorTableSeeder
public function run()
{
    Author::create([
        'admin_id' => '1',
        'name' => ['cn'=>'牟其中', 'en'=>'Qizhong Mou'],
        'slug' => 'qizhong-mou',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
    Author::create([
        'admin_id' => '1',
        'name' => ['cn'=>'总裁办', 'en'=>"CEO Office"],
        'slug' => 'ceo-office',
        'is_published' => '1',
        'created_at' => Carbon::now(),
        'updated_at' => Carbon::now(),
    ]);
}

```

```bash
php artisan db:seed --class=CategoryTableSeeder
php artisan db:seed --class=AuthorTableSeeder
```

### Factory

```php
# UserFactory.php

$factory->define(Post::class, function (Faker $faker) {
    $title = $faker->unique()->sentence;
    $isPublished = ['1', '0'];

    return [
        'admin_id' => '1',
        'title' => ['cn' => rand(1, 10000).'中文标题'.rand(1, 10000), 'en' => $title],
        'slug' => str_slug($title),
        'sub_title' => ['cn' => rand(1, 10000).'中文副标题'.rand(1, 10000), 'en' => $faker->sentence],
        'is_reproduced' => '0',
        'intro' => ['cn' => rand(1, 10000).'中文简介'.rand(1, 10000), 'en' => $faker->paragraph],
        'details' => ['cn' => rand(1, 10000).'中文内容'.rand(1, 10000), 'en' => $faker->paragraph],
        'post_type' => 'post',
        'is_published' => $isPublished[rand(0, 1)],
        'created_at' => now(),
        'updated_at' => now(),
    ];
});

$factory->define(CategoryPost::class, function (Faker $faker) {
    return [
        'category_id' => rand(1, 5),
        'post_id' => rand(1, 20),
    ];
});
```

```bash
php artisan tinker
```

```php
factory(App\Post::class, 20)->create()
factory(App\CategoryPost::class, 20)->create()
```

## Routes

```php
# Admin
Route::prefix('admin')->group(function () {
    # Dashboard
    Route::get('/', 'AdminController@index')->name('admin.dashboard');

    # login, logout, reset password ...

    # CMS
    Route::resource('categories', 'CategoryController');
    Route::resource('posts', 'PostController');
    Route::resource('pages', 'PageController');
    Route::resource('photos', 'PhotoController');
});
```

## CMS Controller and Views

### Dashboard Nav Bar

```php
# AdminController.php
public function __construct()
{
    $this->middleware('auth:admin');
}

public function index()
{
    $title = trans('app.dashboard');
    $categories = Category::orderBy('updated_at', 'DESC')->limit('5')->get();
    $posts = Post::orderBy('updated_at', 'DESC')->where('post_type', 'post')->limit('5')->get();
    $pages = Post::orderBy('updated_at', 'DESC')->where('post_type', 'page')->limit('5')->get();
    return view('admin.dashboard', compact('title', 'categories', 'posts', 'pages'));
}
```

```php
# app.blade.php
<li class="nav-item">
    <a class="nav-link" href="{{ route('admin.dashboard', app()->getLocale()) }}">{{ __('app.dashboard') }}</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{{ route('categories.index', app()->getLocale()) }}">{{ __('admin_CRUD.categories') }}</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{{ route('authors.index', app()->getLocale()) }}">{{ __('admin_CRUD.authors') }}</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{{ route('posts.index', app()->getLocale()) }}">{{ __('admin_CRUD.posts') }}</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{{ route('pages.index', app()->getLocale()) }}">{{ __('admin_CRUD.pages') }}</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{{ route('photos.index', app()->getLocale()) }}">{{ __('admin_CRUD.photos') }}</a>
</li>
```

```php
# admin/dashboard.blade.php
@extends('layouts.app')

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-light">
                    {{ __('admin_dashboard.admin_dashboard') }}
                </div>
                <div class="card-body">
                    {{ __('admin_dashboard.you_are_logged_in') }}
                </div>
            </div>
            <br>

            <div class="card">
                <div class="card-header bg-primary text-light">
                    {{ __('admin_CRUD.latest_posts') }}
                </div>
                <div class="card-body">
                    <table class="table table-bordered mb-0">
                        <thead>
                            <tr>
                                <th scope="col" width="20">{{ __('#') }}</th>
                                // ... add columns as demand
                            </tr>
                        </thead>
                        <tbody>
                            @foreach ($posts as $post)
                                <tr>
                                    <td>{{ $post->id }}</td>
                                    // ... edit as demand
                                </tr>
                            @endforeach
                        </tbody>
                    </table>
                </div>
            </div>
            <br>
            // ... add cards as demand
        </div>
    </div>
</div>
@endsection
```

### Post CRUD (Similar to Catigory, Author)

- Install laravel collective:

```bash
# https://laravelcollective.com/docs/6.0/html
composer require laravelcollective/html
```

- Flash Sessions

```php
@if(Session::has('message'))
    <div class="alert alert-success alert-dismissible text-center">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"><i class="fas fa-times"></i></button>
        {{ session('message') }}
    </div>
@endif
@if(Session::has('danger-message'))
    <div class="alert alert-danger alert-dismissible text-center">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"><i class="fas fa-times"></i></button>
        {{ session('danger-message') }}
    </div>
@endif
@if(Session::has('warning-message'))
    <div class="alert alert-warning alert-dismissible text-center">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"><i class="fas fa-times"></i></button>
        {{ session('warning-message') }}
    </div>
@endif
```

- Create `index`, `create`, `edit` blades in `admin/post/`.

```php
# index
<table class="table table-bordered mb-0">
    <thead>
        <tr>
            <th scope="col" width="10">{{ __('#') }}</th>
            <th scope="col" width="60">{{ __('admin_CRUD.post_title') }}</th>
            <th scope="col" width="30">{{ __('admin_CRUD.original_or_reproduced') }}</th>
            <th scope="col" width="30">{{ __('admin_CRUD.author') }}</th>
            <th scope="col" width="30">{{ __('admin_CRUD.updated_at') }}</th>
            <th scope="col" width="30">{{ __('admin_CRUD.categories') }}</th>
            <th scope="col" width="30">{{ __('admin_CRUD.publish_status') }}</th>
            <th scope="col" width="30">{{ __('admin_CRUD.edit_delete') }}</th>
        </tr>
    </thead>
    <tbody>
        @foreach ($posts as $post)
            <tr>
                <td>{{ $post->id }}</td>
                <td>{{ $post->title }}</td>
                <td>
                    @if ($post->is_reproduced == 1)
                        {{ __('admin_CRUD.reproduced') }}
                    @else
                        {{ __('admin_CRUD.original') }}
                    @endif
                </td>
                <td>
                    @foreach ($post->authors as $author)
                        {{ $author->name }};&nbsp;
                    @endforeach
                </td>
                <td>{{ $post->updated_at }}</td>
                <td>
                    @foreach ($post->categories as $category)
                        {{ $category->name }};&nbsp;
                    @endforeach
                </td>
                <td>
                    @if ($post->is_published == 1)
                        {{ __('admin_CRUD.published') }}
                    @else
                        {{ __('admin_CRUD.draft') }}
                    @endif
                </td>
                <td>
                    <a href="{{ route('posts.edit', [$post->id, app()->getLocale()]) }}" class="btn btn-sm btn-warning px-2">
                        <i class="fas fa-edit fa-lg"></i>
                    </a>
                    <span class="text-gray-500">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                    <a href="{{ route('posts.destroy', [$post->id, app()->getLocale()]) }}" class="btn btn-sm btn-danger px-2">
                        <div style="display: none" id="trans-delete">
                            {{ trans('admin_CRUD.really_want_to_delete') }}
                        </div>
                        <i onclick="event.preventDefault();
                            var message = document.getElementById('trans-delete').textContent;
                            if (confirm(message)) {
                                document.getElementById('post-delete-{{$post->id}}').submit()
                            }" class="fas fa-times fa-lg"></i>
                        <form style="display: none"
                            id="{{ 'post-delete-' . $post->id }}" method="POST"
                            action="{{ route('posts.destroy', [$post->id, app()->getLocale()]) }}">
                            @csrf
                            @method('delete')
                        </form>
                    </a>
                </td>
            </tr>
        @endforeach
    </tbody>
</table>

# create
@extends('layouts.app')

@section('stylesheet')
<link href="{{ asset('css/select2.min.css') }}" rel="stylesheet"/>
@endsection

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-12 flex justify-center">

            <div class="card my-5 w-full lg:w-10/12 xl:w-8/12">
                <div class="card-header">
                    <h2 class="font-bold text-xl ml-10">{{ $title }}</h2>
                </div>
                <div class="card-body">

                    {!! Form::open(['route' => ['posts.store', app()->getLocale()]]) !!}

                    {{-- Tumbnail --}}
                    <div class="form-group @if($errors->has('thumbnail')) has-error @endif">
                        {!! Form::label('thumbnail', trans('admin_CRUD.thumbnail')) !!}
                        &nbsp;&nbsp;
                        <a href="{{ route('photos.index', app()->getLocale()) }}" target="_blank" class="text-primary">
                            {{ __('admin_CRUD.photos') }}
                            <i class="fas fa-external-link-alt fa-sm"></i>
                        </a>
                        {!! Form::text('thumbnail', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.paste_thumbnail_address_here')]) !!}
                        @if ($errors->has('thumbnail'))
                            <span class="help-block text-red-500">{!! $errors->first('thumbnail') !!}</span>
                        @endif
                    </div>

                    {{-- Title --}}
                    <div class="form-group @if($errors->has('title_cn')) has-error @endif">
                        {!! Form::label('title_cn', trans('admin_CRUD.title_cn')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        {!! Form::text('title_cn', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_title_in_cn')]) !!}
                        @if ($errors->has('title_cn'))
                            <span class="help-block text-red-500">{!! $errors->first('title_cn') !!}</span>
                        @endif
                    </div>
                    <div class="form-group @if($errors->has('title_en')) has-error @endif">
                        {!! Form::label('title_en', trans('admin_CRUD.title_en')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        {!! Form::text('title_en', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_title_in_en')]) !!}
                        @if ($errors->has('title_en'))
                            <span class="help-block text-red-500">{!! $errors->first('title_en') !!}</span>
                        @endif
                    </div>

                    {{-- Sub Title --}}
                    <div class="form-group @if($errors->has('sub_title_cn')) has-error @endif">
                        {!! Form::label('sub_title_cn', trans('admin_CRUD.sub_title_cn')) !!}
                        {!! Form::text('sub_title_cn', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_sub_title_in_cn')]) !!}
                        @if ($errors->has('sub_title_cn'))
                            <span class="help-block text-red-500">{!! $errors->first('sub_title_cn') !!}</span>
                        @endif
                    </div>
                    <div style="display: none" class="form-group @if($errors->has('sub_title_en')) has-error @endif">
                        {!! Form::label('sub_title_en', trans('admin_CRUD.sub_title_en')) !!}
                        {!! Form::text('sub_title_en', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_sub_title_in_en')]) !!}
                        @if ($errors->has('sub_title_en'))
                            <span class="help-block text-red-500">{!! $errors->first('sub_title_en') !!}</span>
                        @endif
                    </div>

                    {{-- Reproduced --}}
                    <div class="form-group">
                        {!! Form::label('is_reproduced', trans('admin_CRUD.original_or_reproduced')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        {!! Form::select('is_reproduced', [0 => trans('admin_CRUD.original'), 1 => trans('admin_CRUD.reproduced')], null, ['class' => 'form-control']) !!}
                    </div>
                    <div class="form-group @if($errors->has('source')) has-error @endif">
                        {!! Form::label('source', trans('admin_CRUD.source')) !!}
                        {!! Form::text('source', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_source')]) !!}
                        @if ($errors->has('source'))
                            <span class="help-block text-red-500">{!! $errors->first('source') !!}</span>
                        @endif
                    </div>
                    <div class="form-group @if($errors->has('source_url')) has-error @endif">
                        {!! Form::label('source_url', trans('admin_CRUD.source_url')) !!}
                        {!! Form::text('source_url', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_source_url')]) !!}
                        @if ($errors->has('source_url'))
                            <span class="help-block text-red-500">{!! $errors->first('source_url') !!}</span>
                        @endif
                    </div>

                    {{-- Author --}}
                    <div class="form-group @if($errors->has('author_id')) has-error @endif">
                        {!! Form::label('author_id', trans('admin_CRUD.authors')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        <a href="{{ route('authors.create', app()->getLocale()) }}" target="_blank" class="text-primary">
                            {{ __('admin_CRUD.create_author') }}
                            <i class="fas fa-external-link-alt fa-sm"></i>
                        </a>
                        <div style="display: none" id="trans-select-authors">
                            {{ trans('admin_CRUD.select_authors') }}
                        </div>
                        {!! Form::select('author_id[]', $authors, null, ['class' => 'form-control', 'id'=>'author_id', 'multiple'=>'multiple']) !!}
                        @if ($errors->has('author_id'))
                            <span class="help-block text-red-500">{!! $errors->first('author_id') !!}</span>
                        @endif
                    </div>

                    {{-- Editor --}}
                    <div class="form-group @if($errors->has('editor')) has-error @endif">
                        {!! Form::label('editor', trans('admin_CRUD.editor')) !!}
                        {!! Form::text('editor', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_editor')]) !!}
                        @if ($errors->has('editor'))
                            <span class="help-block text-red-500">{!! $errors->first('editor') !!}</span>
                        @endif
                    </div>

                    {{-- Intro --}}
                    <div class="form-group @if($errors->has('intro_cn')) has-error @endif">
                        {!! Form::label('intro_cn', trans('admin_CRUD.intro_cn')) !!}
                        {!! Form::textarea('intro_cn', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_intro_in_cn')]) !!}
                        @if ($errors->has('intro_cn'))
                            <span class="help-block text-red-500">{!! $errors->first('intro_cn') !!}</span>
                        @endif
                    </div>
                    <div style="display: none" class="form-group @if($errors->has('intro_en')) has-error @endif">
                        {!! Form::label('intro_en', trans('admin_CRUD.intro_en')) !!}
                        {!! Form::textarea('intro_en', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_intro_in_en')]) !!}
                        @if ($errors->has('intro_en'))
                            <span class="help-block text-red-500">{!! $errors->first('intro_en') !!}</span>
                        @endif
                    </div>

                    {{-- Details --}}
                    <div class="form-group @if($errors->has('details_cn')) has-error @endif">
                        {!! Form::label('details_cn', trans('admin_CRUD.details_cn')) !!}
                        {!! Form::textarea('details_cn', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_details_in_cn')]) !!}
                        @if ($errors->has('details_cn'))
                            <span class="help-block text-red-500">{!! $errors->first('details_cn') !!}</span>
                        @endif
                    </div>
                    <div style="display: none" class="form-group @if($errors->has('details_en')) has-error @endif">
                        {!! Form::label('details_en', trans('admin_CRUD.details_en')) !!}
                        {!! Form::textarea('details_en', null, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.input_details_in_en')]) !!}
                        @if ($errors->has('details_en'))
                            <span class="help-block text-red-500">{!! $errors->first('details_en') !!}</span>
                        @endif
                    </div>

                    {{-- Category --}}
                    <div class="form-group @if($errors->has('category_id')) has-error @endif">
                        {!! Form::label('category_id', trans('admin_CRUD.categories')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        <a href="{{ route('categories.create', app()->getLocale()) }}" target="_blank" class="text-primary">
                            {{ __('admin_CRUD.create_category') }}
                            <i class="fas fa-external-link-alt fa-sm"></i>
                        </a>
                        <div style="display: none" id="trans-select-categories">
                            {{ trans('admin_CRUD.select_categories') }}
                        </div>
                        {!! Form::select('category_id[]', $categories, null, ['class' => 'form-control', 'id'=>'category_id', 'multiple'=>'multiple']) !!}
                        @if ($errors->has('category_id'))
                            <span class="help-block text-red-500">{!! $errors->first('category_id') !!}</span>
                        @endif
                    </div>

                    {{-- Publish Status --}}
                    <div class="form-group">
                        {!! Form::label('is_published', trans('admin_CRUD.is_published')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        {!! Form::select('is_published', [0 => trans('admin_CRUD.save_as_draft'), 1 => trans('admin_CRUD.publish')], null, ['class' => 'form-control']) !!}
                    </div>

                    {!! Form::submit(trans('admin_CRUD.create'), ['class' => 'btn btn-primary']) !!}
                    {!! Form::close() !!}

                </div>
            </div>

        </div>
    </div>
</div>
@endsection

@section('javascript')
<script src="{{ asset('js/jquery-3.5.1.min.js') }}"></script>
<script src="https://cdn.ckeditor.com/4.14.1/standard/ckeditor.js""></script>
<script src="{{ asset('js/select2.min.js') }}" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        CKEDITOR.replace('details_cn');
        CKEDITOR.replace('details_en');
        var message = document.getElementById('trans-select-authors').textContent;
        $('#author_id').select2({
            placeholder: message
        });
        var message = document.getElementById('trans-select-categories').textContent;
        $('#category_id').select2({
            placeholder: message
        });
    });
</script>
@endsection

# edit
@extends('layouts.app')

@section('stylesheet')
<link href="{{ asset('css/select2.min.css') }}" rel="stylesheet"/>
@endsection

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-12 flex justify-center">

            <div class="card my-5 w-full lg:w-10/12 xl:w-8/12">
                <div class="card-header">
                    <h2 class="font-bold text-xl ml-10">{{ $title }}</h2>
                </div>
                <div class="card-body">

                    {!! Form::open(['route' => ['posts.update', [$post->id, app()->getLocale()]], 'method'=>'put']) !!}

                    {{-- Tumbnail --}}
                    <div class="form-group">
                        {{ trans('admin_CRUD.original_photo_preview') }}
                        <img width="200" src="{{ $post->thumbnail }}" alt="no photo">
                    </div>
                    <div class="form-group @if($errors->has('thumbnail')) has-error @endif">
                        {!! Form::label('thumbnail', trans('admin_CRUD.thumbnail')) !!}
                        &nbsp;&nbsp;
                        <a href="{{ route('photos.index', app()->getLocale()) }}" target="_blank" class="text-primary">
                            {{ __('admin_CRUD.photos') }}
                            <i class="fas fa-external-link-alt fa-sm"></i>
                        </a>
                        {!! Form::text('thumbnail', $post->thumbnail, ['class' => 'form-control', 'placeholder' => trans('admin_CRUD.paste_thumbnail_address_here')]) !!}
                        @if ($errors->has('thumbnail'))
                            <span class="help-block text-red-500">{!! $errors->first('thumbnail') !!}</span>
                        @endif
                    </div>

                    // ... similar

                    {{-- Category --}}
                    <div class="form-group @if($errors->has('category_id')) has-error @endif">
                        {!! Form::label('category_id', trans('admin_CRUD.categories')) !!}
                        &nbsp;&nbsp;
                        <a href="{{ route('categories.create', app()->getLocale()) }}" target="_blank" class="text-primary">
                            {{ __('admin_CRUD.create_category') }}
                            <i class="fas fa-external-link-alt fa-sm"></i>
                        </a>
                        <div style="display: none" id="trans-select-categories">
                            {{ trans('admin_CRUD.select_categories') }}
                        </div>
                        {!! Form::select('category_id[]', $categories, null, ['class' => 'form-control', 'id'=>'category_id', 'multiple'=>'multiple']) !!}
                        @if ($errors->has('category_id'))
                            <span class="help-block">{!! $errors->first('category_id') !!}</span>
                        @endif
                    </div>

                    {{-- Publish Status --}}
                    <div class="form-group">
                        {!! Form::label('is_published', trans('admin_CRUD.is_published')) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        {!! Form::select('is_published', [0 => trans('admin_CRUD.save_as_draft'), 1 => trans('admin_CRUD.publish')], isset($post->is_published) ? $post->is_published : null, ['class' => 'form-control']) !!}
                    </div>

                    {!! Form::submit(trans('admin_CRUD.update'), ['class' => 'btn btn-warning']) !!}
                    {!! Form::close() !!}

                </div>
            </div>

        </div>
    </div>
</div>
@endsection

@section('javascript')
<script src="{{ asset('js/jquery-3.5.1.min.js') }}"></script>
<script src="https://cdn.ckeditor.com/4.14.1/standard/ckeditor.js""></script>
<script src="{{ asset('js/select2.min.js') }}" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
        CKEDITOR.replace('details_cn');
        CKEDITOR.replace('details_en');
        var message = document.getElementById('trans-select-authors').textContent;
        $('#author_id').select2({
            placeholder: message
        }).val({!! json_encode($post->authors()->allRelatedIds()) !!}).trigger('change');
        var message = document.getElementById('trans-select-categories').textContent;
        $('#category_id').select2({
            placeholder: message
        }).val({!! json_encode($post->categories()->allRelatedIds()) !!}).trigger('change');
    });
</script>
@endsection
```

```php
# PostController
class PostController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth:admin');
    }

    public function index()
    {
        $title = trans('admin_CRUD.post_list');
        $posts = Post::orderBy('id', 'DESC')->where('post_type', 'post')->get();
        return view('admin.post.index', compact('title', 'posts'));
    }

    public function create()
    {
        $title = trans('admin_CRUD.create_post');
        $authors = Author::orderBy('id', 'DESC')->pluck('name', 'id');
        $categories = Category::orderBy('id', 'DESC')->pluck('name', 'id');
        return view('admin.post.create', compact('title', 'authors', 'categories'));
    }

    public function store(Request $request)
    {
        $this->validate($request,
            [
                'title_cn' => 'required|max:191|unique:posts,title->cn',
                'title_en' => 'required|max:191|unique:posts,title->en',
                'author_id' => 'required',
                'category_id' => 'required',
            ],
            [
                'title_cn.required' => trans('admin_CRUD.is_must'),
                'title_en.required' => trans('admin_CRUD.is_must'),
                'title_cn.max' => trans('admin_CRUD.max_limit'),
                'title_en.max' => trans('admin_CRUD.max_limit'),
                'title_cn.unique' => trans('admin_CRUD.already_exist'),
                'title_en.unique' => trans('admin_CRUD.already_exist'),
                'author_id.required' => trans('admin_CRUD.is_must'),
                'category_id.required' => trans('admin_CRUD.is_must'),
            ]
        );

        if ($request->is_reproduced == '1') {
            $this->validate($request,
                [
                    'source' => 'required',
                    'source_url' => 'required',
                ],
                [
                    'source.require' => trans('admin_CRUD.is_must_for_reproduced'),
                    'source_url.require' => trans('admin_CRUD.is_must_for_reproduced'),
                ]
            );
        }

        $post = Post::create([
            'admin_id' => Auth::id(),
            'thumbnail' => $request->thumbnail,
            'title' => ['cn'=>$request->title_cn, 'en'=>$request->title_en],
            'slug' => str_slug($request->title_en),
            'sub_title' => ['cn'=>$request->sub_title_cn, 'en'=>$request->sub_title_en],
            'is_reproduced' => $request->is_published,
            'source' => $request->source,
            'source_url' => $request->source_url,
            'editor' => $request->editor,
            'intro' => ['cn'=>$request->intro_cn, 'en'=>$request->intro_en],
            'details' => ['cn'=>$request->details_cn, 'en'=>$request->details_en],
            'is_published' => $request->is_published,
            'post_type' => 'post',
            'created_at' => Carbon::now(),
            'updated_at' => Carbon::now(),
        ]);

        $post->authors()->sync($request->author_id, false);
        $post->categories()->sync($request->category_id, false);

        Session::flash('message', trans('admin_CRUD.created_successfully'));
        return redirect()->route('posts.index');
    }

    public function show(Post $post)
    {
        //
    }

    public function edit(Post $post)
    {
        $title = trans('admin_CRUD.update_post');
        $authors = Author::orderBy('id', 'DESC')->pluck('name', 'id');
        $categories = Category::orderBy('id', 'DESC')->pluck('name', 'id');
        return view('admin.post.edit', compact('title', 'authors', 'categories', 'post'));
    }

    public function update(Request $request, Post $post)
    {
        $this->validate($request,
            [
                'title_cn' => 'required|max:191|unique:posts,title->cn,' . $post->id,
                'title_en' => 'required|max:191|unique:posts,title->en,' . $post->id,
                'author_id' => 'required',
                'category_id' => 'required',
            ],
            [
                'title_cn.required' => trans('admin_CRUD.is_must'),
                'title_en.required' => trans('admin_CRUD.is_must'),
                'title_cn.max' => trans('admin_CRUD.max_limit'),
                'title_en.max' => trans('admin_CRUD.max_limit'),
                'title_cn.unique' => trans('admin_CRUD.already_exist'),
                'title_en.unique' => trans('admin_CRUD.already_exist'),
                'author_id.required' => trans('admin_CRUD.is_must'),
                'category_id.required' => trans('admin_CRUD.is_must'),
            ]
        );
        if ($request->is_reproduced == '1') {
            $this->validate($request,
                [
                    'source' => 'required',
                    'source_url' => 'required',
                ],
                [
                    'source.require' => trans('admin_CRUD.is_must_for_reproduced'),
                    'source_url.require' => trans('admin_CRUD.is_must_for_reproduced'),
                ]
            );
        }
        $post->admin_id = Auth::id();
        $post->thumbnail = $request->thumbnail;
        $post->title = ['cn' => $request->title_cn, 'en' => $request->title_en];
        $post->slug = str_slug($request->title_en);
        $post->sub_title = ['cn' => $request->sub_title_cn, 'en' => $request->sub_title_en];
        $post->is_reproduced = $request->is_reproduced;
        $post->source = $request->source;
        $post->source = $request->source_url;
        $post->editor = $request->editor;
        $post->intro = ['cn' => $request->intro_cn, 'en' => $request->intro_en];
        $post->details = ['cn' => $request->details_cn, 'en' => $request->details_en];
        $post->is_published = $request->is_published;
        $post->post_type = 'post';
        $post->save();

        $post->authors()->sync($request->author_id, false);
        $post->categories()->sync($request->category_id, false);

        Session::flash('warning-message', trans('admin_CRUD.updated_successfully'));
        return redirect()->route('posts.index');
    }

    public function destroy(Post $post)
    {
        $post->delete();

        Session::flash('danger-message', trans('admin_CRUD.deleted_successfully'));
        return redirect()->route('posts.index');
    }
}
```


### Photos CRUD

- create `index`, `create`, `edit` in `view/admin/photos`

```php
# index
<table class="table table-bordered mb-0">
    <thead>
        <tr>
            <th scope="col" width="5">{{ __('#') }}</th>
            <th scope="col" width="60">{{ __('admin_CRUD.categories') }}</th>
            <th scope="col" width="60">{{ __('admin_CRUD.preview') }}</th>
            <th scope="col" width="80">{{ __('admin_CRUD.img_url') }}</th>
            <th scope="col" width="10">{{ __('admin_CRUD.uploaded_by') }}</th>
            <th scope="col" width="10">{{ __('admin_CRUD.uploaded_at') }}</th>
            <th scope="col" width="10">{{ __('admin_CRUD.delete') }}</th>
        </tr>
    </thead>
    <tbody>
        @foreach ($photos as $photo)
            <tr>
                <td>{{ $photo->id }}</td>
                <td>
                    @foreach ($photo->categories as $category)
                        {{ $category->name }};&nbsp;
                    @endforeach
                </td>
                <td><img width="200" src="{{ asset('storage/photos/' . $photo->image_url) }}" alt="preview"></td>
                <td>{{ asset('storage/photos/' . $photo->image_url) }}</td>
                <td>{{ $photo->admin->name }}</td>
                <td>{{ $photo->created_at }}</td>
                <td>
                    <a href="{{ route('photos.edit', [$photo->id, app()->getLocale()]) }}" class="btn btn-sm btn-warning px-2">
                        <i class="fas fa-edit fa-lg"></i>
                    </a>
                    <span class="text-gray-500">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                    <a href="{{ route('photos.destroy', [$photo->id, app()->getLocale()]) }}" class="btn btn-sm btn-danger px-2">
                        <div style="display: none" id="trans-delete">
                            {{ trans('admin_CRUD.really_want_to_delete') }}
                        </div>
                        <i onclick="event.preventDefault();
                            var message = document.getElementById('trans-delete').textContent;
                            if (confirm(message)) {
                                document.getElementById('photo-delete-{{$photo->id}}').submit()
                            }" class="fas fa-times fa-lg"></i>
                        <form style="display: none"
                            id="{{ 'photo-delete-' . $photo->id }}" method="POST"
                            action="{{ route('photos.destroy', [$photo->id, app()->getLocale()]) }}">
                            @csrf
                            @method('delete')
                        </form>
                    </a>
                </td>
            </tr>
        @endforeach
    </tbody>
</table>

# create
@extends('layouts.app')

@section('stylesheet')
<link href="{{ asset('css/select2.min.css') }}" rel="stylesheet"/>
@endsection

@section('content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-12 flex justify-center">

            <div class="card my-5 w-full lg:w-10/12 xl:w-8/12">
                <div class="card-header">
                    <h2>{{ $title }}</h2>
                </div>
                <div class="card-body">
                    {!! Form::open(['route' => ['photos.store', app()->getLocale()], 'enctype' => 'multipart/form-data']) !!}

                    {{-- Category --}}
                    // ...

                    {{-- Upload --}}
                    <div class="form-group @if($errors->has('image_url')) has-error @endif">
                        {!! Form::file('image_url[]', ['multiple' => 'multiple']) !!}
                        <span class="text-red-500">&nbsp;*&nbsp;</span>
                        @if ($errors->has('image_url'))
                            <span class="help-block text-red-500">{!! $errors->first('image_url') !!}</span>
                        @endif
                    </div>
                    <div>{{ __('admin_CRUD.support_multi_photo') }}</div>
                    <div>{{ __('admin_CRUD.support_png_jpg_jpeg') }}</div>
                    <br>

                    {{-- Intro --}}
                    // ...

                    {{-- Publish Status --}}
                    // ...
                </br>
            </div>

        </div>
    </div>
</div>
@endsection

@section('javascript')
<script src="{{ asset('js/jquery-3.5.1.min.js') }}"></script>
<script src="{{ asset('js/select2.min.js') }}" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var message = document.getElementById('trans-select-categories').textContent;
        $('#category_id').select2({
            placeholder: message
        });
    });
</script>
@endsection

# edit
// ... similar
```

```php
# PhotoConroller
public function __construct()
{
    $this->middleware('auth:admin');
}

public function index()
{
    $title = trans('admin_CRUD.photo_list');
    $photos = Photo::orderBy('id', 'DESC')->get();
    return view('admin.photo.index', compact('title', 'photos'));
}

public function create()
{
    $title = trans('admin_CRUD.photo_upload');
    $categories = Category::orderBy('id', 'DESC')->pluck('name', 'id');
    return view('admin.photo.create', compact('title', 'categories'));
}

public function store(Request $request)
{
    $this->validate($request,
        [
            "category_id" => "required",
            "image_url" => "required",
        ],
        [
            "category_id.required" => trans("admin_CRUD.is_must"),
            "image_url.required" => trans("admin_CRUD.select_image"),
        ]
    );
    foreach ($request->image_url as $image_url) {

        $current_timestamp = Carbon::now()->timestamp;
        $fileNameWithExt = $image_url->getClientOriginalName();
        $fileName = pathinfo($fileNameWithExt, PATHINFO_FILENAME);
        $fileExt = $image_url->getClientOriginalExtension();
        $fileNameToStore = $fileName . '_' . $current_timestamp . '.' . $fileExt;

        $photo = new Photo();
        $photo->admin_id = Auth::id();
        $photo->image_url = $fileNameToStore;
        $photo->intro = ['cn' => $request->intro_cn, 'en' => $request->intro_en];
        $photo->is_published = $request->is_published;
        $save = $photo->save();
        $photo->categories()->sync($request->category_id, false);

        if ($save) {
            $image_url->storeAs('public/photos', $fileNameToStore);
        }
    }
    Session::flash('message', trans('admin_CRUD.image_uploaded_successfully'));
    return redirect()->route('photos.index');
}

public function show(Photo $photo)
{

}

public function edit(Photo $photo)
{
    $title = trans('admin_CRUD.update_photo_info');
    $categories = Category::orderBy('id', 'DESC')->pluck('name', 'id');
    return view('admin.photo.edit', compact('title', 'photo', 'categories'));
}

public function update(Request $request, Photo $photo)
{
    $this->validate($request,
        [
            "category_id" => "required",
        ],
        [
            "category_id.required" => trans("admin_CRUD.is_must"),
        ]
    );

    $photo->admin_id = Auth::id();
    $photo->intro = ['cn' => $request->intro_cn, 'en' => $request->intro_en];
    $photo->is_published = $request->is_published;
    $photo->save();
    $photo->categories()->sync($request->category_id, false);

    Session::flash('warning-message', trans('admin_CRUD.updated_successfully'));
    return redirect()->route('photos.index');
}

public function destroy(Photo $photo)
{
    Storage::delete('public/photos/' . $photo->image_url);
    $photo->delete();

    Session::flash('danger-message', trans('admin_CRUD.images_deleted_successfully'));
    return redirect()->route('photos.index');
}
```

- run `php artisan storage:link`
