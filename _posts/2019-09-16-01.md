---
layout: default
title: Installation and Update of V2ray on Debian Server
published_at: "2019-09-16"
updated_at: "2019-10-01"
author: Taners
tags: [Installation, V2ray, Debian, Server, VPN]
status: published
---


[BACK TO HOME](https://tane-rs.github.io)

# {{page.title}}

by {{page.author}} |
published at {{page.published_at | date: "%Y-%m-%d"}} |
updated at {{ page.updated_at | date: "%Y-%m-%d" }}

---

## Pre Request
- VPS Server：
    - For normal user： VirMach;
    - For playing foreign games: HOSTFLYTE-Asia optimized;
- Debian
```bash
apt update
apt upgrade upgrade
grep security /etc/apt/sources.list | tee /etc/apt/security.sources.list
apt upgrade -o Dir::Etc::SourceList=/etc/apt/security.sources.list
# add users
# use nano to config ssh and hostname
# Installing utilities: sudo htop curl wget unzip
```
- [官方文档](https://www.v2ray.com/) can help you choose right selection during the installation; (don't trust script easily)
- [白话文版](https://guide.v2fly.org/prep/install.html#%E8%84%9A%E6%9C%AC%E5%AE%89%E8%A3%85)
- [配置方案指南](https://github.com/KiriKira/vTemplate?files=1)
- [配置文件生成器](https://www.veekxt.com/utils/v2ray_gen)


## Install/Update V2ray on Server
```bash
# Install this version
su
cd ~/Download
bash <(curl -L -s https://install.direct/go.sh)
# Same command for update

systemctl start v2ray
systemctl enable v2ray
systemctl status v2ray

nano /etc/v2ray/config.json

# Check format of json
/usr/bin/v2ray/v2ray -test -config /etc/v2ray/config.json

systemctl restart v2ray

su -

apt update 
apt upgrade

adduser username
usermod -aG sudo username
vi /etc/ssh/sshd_config # RootPermition

## Uninstall V2ray on Server
su -
# If other version need to be uninstalled
systemctl stop v2ray
systemctl disable v2ray
service v2ray stop
update-rc.d -f v2ray remove
rm -rf /etc/v2ray/*  #(配置文件)
rm -rf /usr/bin/v2ray/*  #(程序)
rm -rf /var/log/v2ray/*  #(日志)
rm -rf /lib/systemd/system/v2ray.service  #(systemd 启动项)
rm -rf /etc/init.d/v2ray  #(sysv 启动项)
```

## Forbid BT
```json
  "routing": {
    "domainStrategy": "AsIs",
    "rules": [
      {
        "type": "field",
        "outboundTag": "block",
        "protocol": [
          "bittorrent"
        ]
      }
    ]
  }
```

## BBR Accelerator
```bash
# BBR
uname -r    # 查看当前内核
dpkg -l | grep linux-*  # 查看安装的内核
# 如果需要删除旧内核
  apt-get purge xxx-img-xxx
  apt autoremove

# 这是一个含内核更新并启用BBR的一键安装脚本
wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh && chmod +x bbr.sh && ./bbr.sh

# reboot
uname -r    # 查看更新后的内核
# 验证是否开启成功
sysctl net.ipv4.tcp_available_congestion_control    # bbr
sysctl net.ipv4.tcp_congestion_control  # bbr
lsmod | grep bbr    # bbr

# 若需要手动启用bbr
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf    
echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
```

## TLS secure protocol (if use web or h2)
```bash
# need a domain name asign to the IP without cloudflare first
su -

# may be need dependencies
apt-get install netcat
apt-get install socat

# install a certificate
curl https://get.acme.sh | sh
source ~/.bashrc

# check port 80 is not in use
lsof -i -P -n 

# create ecc certificates
~/.acme.sh/acme.sh --issue -d domainname.me --standalone -k ec-256

# update certificates manually (it also will automatic every 60 days)
~/.acme.sh/acme.sh --renew -d domainname.me --force --ecc
# create the certificate to dir /etc/v2ray/
~/.acme.sh/acme.sh --installcert -d domainname.me --fullchainpath /etc/v2ray/v2ray.crt --keypath /etc/v2ray/v2ray.key --ecc
```
__When TLS is done, can use http/2 or plus web__

## Install Caddy (if use web or h2)
```bash
# Install Caddy
curl https://getcaddy.com | bash -s personal

# Caddy - 方便够用的 HTTPS server 新手教程 https://www.zybuluo.com/zwh8800/note/844776
# 文件目录
mkdir /etc/caddy
touch /etc/caddy/Caddyfile
chown -R root:www-data /etc/caddy
mkdir /etc/ssl/caddy
chown -R www-data:root /etc/ssl/caddy
chmod 0770 /etc/ssl/caddy
mkdir /var/www
chown www-data:www-data /var/www

# 从 github 下载 systemd 配置文件
curl -s https://raw.githubusercontent.com/mholt/caddy/master/dist/init/linux-systemd/caddy.service -o /etc/systemd/system/caddy.service   
systemctl daemon-reload        # 重新加载 systemd 配置
systemctl enable caddy.service # 设置 caddy 服务自启动
systemctl status caddy.service # 查看 caddy 状态

# 利用 Caddy 非常简单的部署 反向代理/镜像（支持自签SSL证书） https://doubibackup.com/l-en8vwt-2.html

```
## Note 

For now default setting is enough, no need to use kcp, tls, web or anything else, for the censership can sniff any masked stream

---
{% for tag in page.tags %}
  {{ tag }}
{% endfor %}

[BACK TO HOME](https://tane-rs.github.io)





