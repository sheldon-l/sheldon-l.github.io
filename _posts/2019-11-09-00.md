---
layout: post
title: Linux 9 - Basics of Linux
published_at: "2019-11-09"
updated_at: "2020-04-20"
author: Taners
tags: [Linux, Unix, BSD]
---

## What is Linux

- Linux is the operating system kernel, which started by the boot loader, which itself started by the BIOS/UEFI;
- Ensures coordination between hardware and software, including managing hardware, processing, users, permissions, and the file system;
- Provides common base to all programs, runs in `ring zero` (`kernel space`); 
- Everything out kernel is `user space`;

## Linux History

- [Unix](https://en.wikipedia.org/wiki/Unix): [Solaris](Solaris_(operating_system)), AIX, HP-UX

- [Berkeley Software Distribution](https://en.wikipedia.org/wiki/Berkeley_Software_Distribution): [FreeBSD](https://en.wikipedia.org/wiki/FreeBSD), [Darwin](https://en.wikipedia.org/wiki/Darwin_%28operating_system%29)

- [Linux](https://en.wikipedia.org/wiki/Linux): Fedora, Debian, CentOS, OpenSUSE
![timeline](https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Unix_timeline.en.svg/1024px-Unix_timeline.en.svg.png)

## File systems

- [What is File System](https://en.wikipedia.org/wiki/File_system)
- File systems are prominent aspect of the kernel.
  - Unix-like systems:
    - merge all the file stores into a single hierarchy, which allows users and applications to access data by knowing its location within that hierarchy: `/`, `/home/user_name`, `/home/user_name/Desktop/file.txt`
  - Linux:
    - possesses only one such hierachy, and the others `mount` on directories in the hierarchy, then available under the `mount point`, allow storing user's `/home/` on a seperate hard disk, once you mount the disk on `/home`, these directories become accessible and keep working.
- There are many file system formats:
  - `VFAT` used by DOS and Windows, and the hard disk is accessible under Linux;
  - `NFS`: network filesystems;
  - `ext2`, `ext3`, `ext4` are widely used in Linux:
    - Formating: `mkfs.ext3` (Make FileSystem)

### Debian Filesystem Hierarchy Standard (FHS)

- Kernel exports data about detected hardware through the `/proc/` and `/sys/` virtual file systems;
- Applications often access devices by way of files created whithin `/dev/`:
  - partitions: `/dev/sda1`;
  - mice: `/dev/input/mouse0`;
  - keyboards: `/dev/input/event0`;
  - sound cards: `/dev/snd/*`;
  - serial ports: `/dev/ttyS*`;

- There are two types of device files:
  - `block`: has finit size, can access at any position, e.g. disk drives and partitions;
  - `character`: like a flow of characters, can read and write, but cannot seek to a given position and change arbitrary bytes, e.g. mouse, keyboard, serial ports;

  ```bash
  ls -l /dev/sda /dev/ttyS0
  # results:
  # brw-rw---- 1 root disk    8,  0 Apr 21 07:43 /dev/sda     # b for block
  # crw-rw---- 1 root dialout 4, 64 Apr 21 07:43 /dev/ttyS0   # c for character
  ```

- The File System:

  - `/bin/` - basic programs (ls, cd, cat, ...)
  - `/boot/` - kernel and other files required for early boot process
  - `/etc/` - configuration files
  - `/home/user_name` - user's personal files, application configuration files are often stored directly as `~/.dotfiles`
  - `/lib/` - basic libraries
  - `/media/*` - mount points for removable devices
  - `/mnt/` - temporary mount point
  - `/opt/` - extra applications provided by third parties
  - `/root/` - administrator's personal files
  - `/run/` - volatile runtime data (not yet included in th FHS)
  - `/sbin/` - system programs (fdisk, mkfs, sysctl, ...)
  - `/srv/` - data used by servers hosted on this system
  - `/temp/` - temporary files (typically deleted on boot)
  - `/usr/`:
    - `/usr/bin/`/`/usr/sbin/`/`/usr/lib/` - same logic as in the `/`
    - `/usr/share/` - application support and data files
    - `/usr/local/` - used by the administrator for installing applications manually without overwriting files handled by dt packaging system (`dpkg`)
  - `/var/` - variable data handled by daemons, including log, queues, spools, and caches
  - `/proc/` and `/sys/` - specific to the Linux kernel, not part of the FHS, used by the kernel for exporting data to user space.

## Managing Processes

- Unix-like systems, kernel devides CPU (1 core, 1 thread) time into small slice and run each inturn. processes identified by process identification (`PID`)

## Managing Permissions

- Processes also idetified by the user who started it.

## Basic Commands

- Lunix widely use GNOME Terminal, accessible by `Ctrl + Alt + F1 ~ F6`, `Ctrl` can be omitted if you are already in text mode;

- Just list basic commands, more detail is in [Linux 7 - Basic Operation For Debian-liked System](https://tane-rs.github.io/2019/10/29/00.html)

### Open mannual by `man [pages]` and `apropos [pages]`, 
- `man [pages]` Divided into following sections:
  - User commands
  - Programming interfaces for kernel system calls
  - Programming interfaces to the C library
  - Special files such as device nodes and drivers
  - File formats
  - Miscellaneous
  - System administration commands

```bash
man ls
man passwd

man -k passwd       # -k: key word, will return section of a key word
man -k `^passwd$`

man 5 passwd        # 5: the section returned by above command

apropos passwd      # equivalent to `man -k [pages]`
apropos partition
```

### Browsing the Directory Tree and Managing Files

```bash
# list
ls
ls -al


# Moving around
cd
pwd


# Creating/Removing Directoris
mkdir [dir_name1] [dir_name2]
rm -rf [dir_name1]/ [dir_name2]/

mkdir ["dir name"]
rmdir ["dir name"]

rm -rf ["dir name"]/
# OR
rm -rf [dir\ name]/

mkdir -p [dir_name]/{sub_dir1,sub_dir2,sub_dir3}
ls -l [dir_name]/


# copy and move
cp [source_file] [target_file]
mv [source_file] [target_file]


# Finding Files
locate [file]   # just search in `locate.db` updated by `corn`

which [file]    # return $PATH
echo $PATH

find [file]     # most complex and flexible
sudo find / -name sbd*

type rm
type cd
```

### SSH Service

```bash
# start
sudo systemctl start ssh
sudo ss -antlp | grep sshd

sodo systemctl enable ssh
```

### HTTP Service

- Often used in penetration

```bash
# start
sudo systemctl start apache2
sudo ss -antlp | grep apache2

sodo systemctl enable apache2
```

### List All Available Services

```bash
systemctl list-unit-files

lsof -i -P -n
```

### APT Packages

```bash
sudo apt update
sudo apt upgrade
sudo apt upgrade [package]

apt-cashe search [package]
apt show [package]

sudo apt install [package]

sudo apt remove --purge [package]
```

### `dpkg`

- `dpkg` is the core tool to install a package `.deb`, either directly or indirectly through APT.

```bash
sudo dpkg -i [package.deb]

sudo dpkg -r [package.deb]
```

## Command Line

- See help doc in `man [command]` for more detail
- See [Linux 7 - Usfule Commands For Debian-liked System](https://tane-rs.github.io/2019/10/29/00.html) for more examples

### Environment Variables

- Can be defined system-wide in `/etc/profile` or user's `~/.profile`, but variables that are not specific to command line interpreters are better put in `/etc/environment`, since those variables will be injected into all user sessions thanks to a Pluggable Authentication Module (PAM) even when no shell is executed.

```bash
# display
echo $PATH
echo $PWD
echo $HOME
echo $USER

echo "$$"   # process ID

# define variables 
# available to any subprocesses spawn from current bash.
export all_proxy=socks5:127.0.0.1:1080

export address=10.11.1.120
ping -c 2 $address


# define variables
# only available in current shell
var="My Var"
echo "$$"
echo $var   # "My Var"

# new a bash and the process ID
bash
echo "$$"
echo $var   # Nonthing
exit


# default `env`
env
```

### History

```bash
cat /etc/lsb-release
history
clear
history
!1      # case 1 in history

sudo systemctl restart apache2
!!      # repeat last one

echo $HISTSIZE      # number of history in memory
echo $HISTFILESIZE  # number of history in history file
vim ~/.bashrc       # edit env vars

# # Search in history
# J: scroll backwards
# L: scroll forwards
# Ctrl + r: revers-i-search, match history according to your typing 
```

### Piping and Redirection

- Every program run from the command line has three data stream connected to it that serve as communication channels with the external environment. These streams are defined as:

  Stream Name | Description
  -|-
  STDIN | Data fed into the program
  STDOUT | Output from the program (default to terminal)
  STDERR | Err messages (default to terminal)


- Piping: `|`

- Redirecting: `<` and `>`

```bash
## STDIN
# redirecting to new file
ls
echo "test"
echo "test" > redirection_test.txt
ls
cat redirection_test.txt
echo "Kali Linux is an open source project" > redirection_test.txt
cat redirection_test.txt

# redirecting to an existing file
echo "that is maintained and funded by Offensive Security" >> redirection_test.tx
cat redirection_test.txt

## STDOUT
# redirecting from a file
wc -m < redirection_test.txt   
# redirection_test.txt is STDIN
# output (char count) is STDOUT

## STDERROR
ls ./not_exist 2>> error.txt   # 2: don't print err in screen
cat error.txt

## Piping
cat error.txt | wc -m > count.txt
cat count.txt
```

### Text Searching and Manipulating

```bash
# grep
ls -la /usr/bin | grep zip

# sed
echo "I need to try hard" | sed 's/hard/harder/'

# cut
echo "I hack binaries, web apps, mobile apps" | cut -f 2 -d ","
cat /etc/passwd
cut -d ":" -f 1 /etc/passwd

# awk
echo "hello::there::friend" | awk -F "::" '{print $1 $3}'
echo "hello::there::friend" | awk -F "::" '{print $1, $3}'


# practical example
gunzip access_log.txt.gz
mv access_log.txt access.log    # a long log
head access.log                 # check head, like following
```
```
201.21.152.44 - - [25/Apr/2013:14:05:35 -0700] "GET /favicon.ico HTTP/1.1" 404 89 "-" "Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.31 (KHTML, like Gecko) Chrome/26.0.1410.64 Safari/537.31" "random-site.com"
70.194.129.34 - - [25/Apr/2013:14:10:48 -0700] "GET /include/jquery.jshowoff.min.js HTTP/1.1" 200 2553 "http://www.random-site.com/" "Mozilla/5.0 (Linux; U; Android 4.1.2; en-us; SCH-I535 Build/JZO54K) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30" "www.random-site.com"
```
```bash
wc -l access.log                # count lines
cat access.log | cut -d " " -f 1 | sort -u  # cut the word before the first " ", and sort the result
cat access.log | cut -d " " -f 1 | sort | uniq -c | sort -urn
cat access.log | grep '70.194.129.34' | cut -d "\"" -f 2 | uniq -c
cat access.log | grep '70.194.129.34' | grep '/include' | sort -u
cat access.log | grep '70.194.129.34' | grep -v '/include'

# sort : sort
# sort -u : sort and unique

```

### Editing Files

- nano

- vi

- [vim](https://tane-rs.github.io/2019/12/05/00.html)

### Comparing Files

```bash
# comm
comm scan_a.txt scan_b.txt  # unique in a, unique in b, common in ab
comm -12 scan_a.txt scan_b.txt  # only common in ab

# diff
diff -c scan_a.txt scan_b.txt
diff -u scan_a.txt scan_b.txt

# vimdiff
vimdiff scan_a.txt scan_b.txt  # open vim with multiple files
```

### Managing Processes

```bash
# Ctrl + c : cancel
# Ctrl + z : wait in background
bg   # background

jobs # jobs running in current terminal sesion

ps -ef
ps -fC [command_name]

kill
```

### Monitoring File and Command

```bash
sudo tail -f /var/log/apache2/access.log

watch -n 5 w
```

### Downloading Files

```bash
wget
curl
axel #download accelerator that transfers a file from a FTP or HTTP server through multiple connections
```

### Customizing the Bash Environment

- [](https://tane-rs.github.io/2019/11/14/00.html)