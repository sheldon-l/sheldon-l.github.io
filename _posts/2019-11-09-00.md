---
layout: post
title: Linux 9 - Basics of Linux
published_at: "2019-11-09"
updated_at: "2020-04-20"
author: Taners
tags: [Linux, Unix, BSD]
---

## What is Linux

- Linux is the operating system kernel, which started by the boot loader, which itself started by the BIOS/UEFI;
- Ensures coordination between hardware and software, including managing hardware, processing, users, permissions, and the file system;
- Provides common base to all programs, runs in `ring zero` (`kernel space`);
- Everything out kernel is `user space`;

## Linux History

- [Unix](https://en.wikipedia.org/wiki/Unix): [Solaris](Solaris_(operating_system)), AIX, HP-UX

- [Berkeley Software Distribution](https://en.wikipedia.org/wiki/Berkeley_Software_Distribution): [FreeBSD](https://en.wikipedia.org/wiki/FreeBSD), [Darwin](https://en.wikipedia.org/wiki/Darwin_%28operating_system%29)

- [Linux](https://en.wikipedia.org/wiki/Linux): Fedora, Debian, CentOS, OpenSUSE
![timeline](https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Unix_timeline.en.svg/1024px-Unix_timeline.en.svg.png)

## The Boot Process, init and Services

- `Power On` - `BIOS` - `MBR (First Sector of the Hard Disk)` - `Boot Loader` - `Kernel` - `initramfs` - `/sbin/init` - `Shell by getty` - `(X Windows System) GUI`

- `/sbin/init`:

  - Traditionally, `/sbin/init` is serial processes `SysVinit`, did not easily take advantage of the *parallel processing*. Some modern methods, such as the use of containers, can require almost instantaneous startup times. Thus, systems now require methods with faster and enhanced capabilities

  - `Upstart` Developed by Ubuntu and first included in 2006; Adopted in Fedora 9 (in 2008) and in RHEL 6 and its clones.

  - `systemd` Adopted by Fedora first (in 2011); Adopted by RHEL 7 and SUSE; Replaced Upstart in Ubuntu 16.04; Replaced `Upstart` in Ubuntu 16.04. It has been adopted by the major distributions

  - `/sbin/init` now just points to `/lib/systemd/systemd`;

```bash
# start|stop|restart|enable|disable
sudo systemctl start|stop|restart nfs.service
sudo systemctl enable|disable nfs.service

# Confirm
sudo ss -antlp | grep [service]

# List all available services
systemctl list-unit-files
lsof -i -P -n
```

## Partitions and Filesystems

- A partition is a physically contiguous section of a disk, or what appears to be so in some advanced setups.

- A filesystem is a method of storing/finding files on a hard disk (usually in a partition).

- File systems are prominent aspect of the kernel.
  - Unix-like systems:
    - merge all the file stores into a single hierarchy, which allows users and applications to access data by knowing its location within that hierarchy: `/`, `/home/user_name`, `/home/user_name/Desktop/file.txt`
  - Linux:
    - possesses only one such hierachy, and the others `mount` on directories in the hierarchy, then available under the `mount point`, allow storing user's `/home/` on a seperate hard disk, once you mount the disk on `/home`, these directories become accessible and keep working.
- There are many file system formats:
  - `VFAT` used by DOS and Windows, and the hard disk is accessible under Linux;
  - `NFS`: network filesystems;
  - `ext2`, `ext3`, `ext4` are widely used in Linux:
    - Formating command: '`mkfs.ext3`' (Make FileSystem)

### Debian Filesystem Hierarchy Standard (FHS)

- Kernel exports data about detected hardware through the `/proc/` and `/sys/` virtual file systems;
- Applications often access devices by way of files created whithin `/dev/`:
  - partitions: `/dev/sda1`;
  - mice: `/dev/input/mouse0`;
  - keyboards: `/dev/input/event0`;
  - sound cards: `/dev/snd/*`;
  - serial ports: `/dev/ttyS*`;

- There are two types of device files:
  - `block`: has finit size, can access at any position, e.g. disk drives and partitions;
  - `character`: like a flow of characters, can read and write, but cannot seek to a given position and change arbitrary bytes, e.g. mouse, keyboard, serial ports;

  ```bash
  ls -l /dev/sda /dev/ttyS0
  # results:
  # brw-rw---- 1 root disk    8,  0 Apr 21 07:43 /dev/sda     # b for block
  # crw-rw---- 1 root dialout 4, 64 Apr 21 07:43 /dev/ttyS0   # c for character

  file /dev/sda*
  file /dev/snd/*
  ```

- The File System:

  - `/bin/` - basic programs (ls, cd, cat, ...)
  - `/boot/` - kernel and other files required for early boot process
  - `/etc/` - configuration files
  - `/home/user_name` - user's personal files, application configuration files are often stored directly as `~/.dotfiles`
  - `/lib/` - basic libraries
  - `/media/*` - mount points for removable devices
  - `/mnt/` - temporary mount point
  - `/opt/` - extra applications provided by third parties
  - `/root/` - administrator's personal files
  - `/run/` - volatile runtime data (not yet included in th FHS)
  - `/sbin/` - system programs (fdisk, mkfs, sysctl, ...)
  - `/srv/` - data used by servers hosted on this system
  - `/temp/` - temporary files (typically deleted on boot)
  - `/usr/`:
    - `/usr/bin/`/`/usr/sbin/`/`/usr/lib/` - same logic as in the `/`
    - `/usr/share/` - application support and data files
    - `/usr/local/` - used by the administrator for installing applications manually without overwriting files handled by dt packaging system (`dpkg`)
  - `/var/` - variable data handled by daemons, including log, queues, spools, and caches
  - `/proc/` and `/sys/` - specific to the Linux kernel, not part of the FHS, used by the kernel for exporting data to user space.

```bash
tree -aCd -L 1 /
tree -aCd -L 1 /usr
tree -aCd -L 2 /home
tree -aCd -L 1 /var
```

## Software

- Common applications (such as the Firefox web browser and LibreOffice office suite)
- Developer tools (like the `vi` and `emacs` text editors)
- Popular services, (such as the Apache web server tools or MySQL database)
- Desktop (such as `GNOME` or `KDE`)
- All installers set up some initial security features on the new system. One basic step consists of setting the password for the superuser (root) and setting up an initial user. In some cases (such as Ubuntu), only an initial user is set up; direct root login is not configured and root access requires logging in first as a normal user and then using `sudo`.
- Some distributions will also install more advanced security frameworks, such as `SELinux` or `AppArmor`. For example, all Red Hat-based systems including Fedora and CentOS always use `SELinux` by default, and Ubuntu comes with `AppArmor` up and running.

### Browser

- Graphical: Firefox, Google Chrome, Chromium, Epiphany (renamed web), Konqueror, Opera

- Text: linx, lynx, w3m

### Email

- Graphical: Thunderbird, Evolution, and Claws Mail

- Text: Mutt and mail

- All web browser-based clients, such as Gmail, Yahoo Mail, and Office 365.

### Office Applications

- LibreOffice:
  - Writer: Word Processing
  - Calc: Spreadsheets
  - Impress: Presentations
  - Draw: Create and edit graphics and diagrams.

- Internet-based office suites such as Google Docs and Microsoft Office 365.

### Development Applications

*On other operating systems, these tools have to be obtained and installed separately, often at a high cost, while on Linux they are all available at no cost through standard package installation systems.*

- Advanced editors: vi, emacs
- Compilers: gcc
- Debuggers: gdb
- Performance measuring and monitoring programs
- Complete Integrated Development Environments (IDE's) such as Eclipse

### Sound Players

- MP3 player with a graphical interface: Amarok
- To record and edit sounds: Audacity
- Rhythmbox
- Online music streaming services, such as Pandora and Spotify through web browsers

### Movie Players

- VLC, MPlayer, Xine, Totem

### Movie Editors

- Cinepaint: for editing images in a video
- Blender: create 3D animation and design
- Cinelerra: Capture, compose, and edit audio/video
- FFmpeg: Record, convert, and stream audio/video

### Graphics Utilities

- GIMP (GNU Image Manipulation Program): The GNU Image Manipulation Program (GIMP) is a feature-rich image retouching and editing tool similar to *Adobe Photoshop* and is available on all Linux distributions.
- Eye of Gnome (eog): an image viewer that provides slide show capability and a few image editing tools
- Inkscape: An image editor with lots of editing features. It works with layers and transformations of the image. It is sometimes compared to *Adobe Illustrator*.
- `convert`: A command line tool (part of the ImageMagick set of applications) that can modify image files in many ways. The options include file format conversion and numerous image modification options, such as blur, resize, despeckle, etc.
- Scribus: Scribus is used for creating documents used for publishing and providing a What You See Is What You Get (WYSIWYG) environment.

### Others

- Graphical FTP client: FileZilla
- To access Internet Relay Chat (IRC) networks: Pidgin, Hexchat
- To connect to Voice over Internet Protocol (VoIP) networks: Ekiga

## Install Source

- Many installers can do an installation completely automatically, using a configuration file to specify installation options. This file is called a `Kickstart file` for Red Hat-based systems, an `AutoYAST profile` for SUSE-based systems, and a `Preseed file` for Debian-based systems.

## Appearance

```bash
sudo apt install gnome-tweaks
```

## Package Management Systems

- Package management systems operate on two distinct levels:
  - a low-level tool (such as `dpkg` or `rpm`) takes care of the details of unpacking individual packages, running scripts, getting the software installed correctly;
  - a high-level tool (such as `apt` (on `dpkg`), `yum` (on `rpm`), `dnf` (replacement of `yum`) or `zypper` (on `rpm`)) works with groups of packages, downloads packages from the vendor, and figures out dependencies.
- Most of the time users need to work only with the high-level tool
- Dependency resolution is a particularly important feature of the high-level tool

## Managing Processes

Process Types | Description | Examples
-|-|-
Interactive Processes | Started by a user | `bash`, `firefox`, `top`
Batch Processes | Automatic processes scheduled from and then disconnected from the terminal, queued and work on a *First-In, First-Out* basis | `updatedb`, `ldconfig`
Daemons | Server processes that run continuously, wait for a user or system request | `httpd`, `sshd`, `libvirtd`
Threads | Lightweight processes, run under the umbrella of a main process, sharing memory and other resources, but are scheduled and run by the system on an individual basis, end without terminating the whole process, a process can create new threads at any time. | `firefox`, `gnome-terminal-server`
Kernel Threads | Kernel tasks that users neither start nor terminate and have little control over. These may perform actions like moving a thread from one CPU to another, or making sure input/output operations to disk are completed. | `kthreadd`, `migration`, `ksoftirqd`

- Unix-like systems, kernel devides CPU (1 core, 1 thread) time into small slice and run each inturn. processes identified by process identification (`PID`). Processes also idetified by the user who started it.

```bash
ps aux | grep <keyword> # running progress
ps -ef
ps -fC [command_name]

kill -[signal] [pid]    # force kill
term [pid]              # terminate gracefully

# Ctrl + c : cancel process
# Ctrl + z : pauses the process and wait in background

jobs -l # jobs running in the background

fg %[job-number]  # restores a job to the foreground
bg %[job-number]  # restarted in the background
kill %[job-number]

# Scheduling Process
crond     # run every day/week/month...
at        # run once at a future point
```

- Nice Value: -10 ~ +19, the lower value the higher priority, only root user can renice a process to a negative value to give it higher priority.

```bash
# Setting the Priority when Starting Process
nice -n <value> /bin/<someSlowProcess> # increament the nice value by <value>

# Changing the Priority of a Runing Process
renice <value> <PID>
```

- Zombie Process.
- In Linux, whether working from shell or GUI, all process are in a shell.
- Reconnaissance and Daemon.

## Managing Permissions

- Linux is a multi-user system so it is necessary to provide a permissions system to control the set of authorized operations on files and directories, which includes all the system resources and devices.
  - Types of users (ordered): owner, group, others = `u`, `g`, `o`;
  - Types of rights (ordered): read, write, execute = `r`, `w`, `x` = 100, 010, 001 = 4, 2, 1;
  - `R`, `W`, `X` apply only to directories.
  - Modes: add, remove, set =  `+`, `-`, `=`
  - Linux set permission `666`(file) and `777`(dir) as default after downloading.

- Special Permissions
  - Granting Temporary Root Permissions with SUID (`setuid`, SET User ID): enter a 4 before the regular permissions: `644 -> 4644`
  - Granting Temporary Root User's Permissions with SGID (`setgid`, SET Group ID): enter a 2 before the regular permissions: `644 -> 2644`, or symbolized with the letter `s`;
  - The Outmoded Sticky Bit (Unix)

- There are two ways of representing rights:

```bash
# Opt1. Symbolic representation
chmod <-R> <a|u|g|o><-|+|=><w|r|x|X> [file] # -R = Recursive, a = ugo, X = applies only to directories
chmod -R a+X [directory]
ch

# Opt2. The (octal) numeric representation
chmod 467 [file]
# The most frequent right combinations are 755 for executable files and directories, and 644 for data files.
chmod 4467 [file]  # add bit 4, Granting Temporary Root User’s Permissions with `setuid`
chmod 2467 [file]  # add bit 2, Granting Temporary Root User’s Permissions with `setgid`
chmod 1467 [file]  # add bit 1, Granting Temporary Root User’s Permissions with `sticky`
# The use of octal notation only allows you to set all the rights at once on a file
umask # will see a mask such as 0022, used to restrict permissions on newly created files
```

- Changing the user and group

```bash
chown [user]:[group] [file]
chgrp [group] [file]
chmod [rights] [file]
```

- Users and Groups:
  - `/etc/passwd` - list of users
  - `/etc/shadow` - encrypted passwords for users
  - `/etc/group` - list of groups
  - `/etc/gshadow` - encrypted passwords for groups

```bash
getent passwd [user]   # return the information from the user database

adduser [user]
adduser [user] [group] # conf file in /etc/adduser.conf
passwd [user]          # updates the /etc/shadow
chfn [user]            # CHange Full Name
chsh [user]            # CHange SHell among /etc/shells
chage [user]           # CHange passwd AGE
chage -l [user]        # list passwd age
passwd -e [user]       # forces the user to change their password
passwd -<l|u> [user]   # lock/unlock
<addgroup|delgroup> [group]
groupmod
gpasswd [group]        # change
gpasswd -r [group]     # remove
```

- TIP: A directory is handled differently from a file.
  - Read access gives the right to consult the list of its contents (files and directories);
  - Write access allows creating or deleting files;
  - Execute access allows crossing through the directory to access its contents (for example, with the `cd` command). Being able to cross through a directory without being able to read it gives the user permission to access the entries therein that are known by name, but not to find them without knowing their exact name.

- SECURITY: `setuid` and `setgid` executable *files*:
  - The `setuid` and `setgid`are relevant to executable *files*.
  - These two rights allow any user to execute the program with the rights of the owner or the group, respectively.
  - This mechanism grants access to features requiring higher level permissions than those you would usually have.
  - Since a `setuid` root program is systematically run under the super-user identity, it is very important to ensure it is secure and reliable.
  - Any user who manages to subvert a `setuid` root program to call a command of their choice could then impersonate the root user and have all rights on the system.
  - Penetration testers regularly search for these types of files when they gain access to a system as a way of escalating their privileges.

- SECURITY: `setgid` *directory* and `sticky bit`:
  - The `setgid` bit also applies to *directories*.
  - Any newly-created item in such directories is automatically assigned the owner group of the parent directory, instead of inheriting the creator’s main group as usual. Because of this, you don’t have to change your main group (with the `newgrp` command) when working in a file tree shared between several users of the same dedicated group.
  - The `sticky` bit (symbolized by the letter “`t`”) is a permission that is only useful in directories.
  - It is especially used for temporary directories where everybody has write access (such as `/tmp/`): it restricts deletion of files so that only their owner or the owner of the parent directory can delete them.

## Environment Variables

- Can be defined system-wide in `/etc/profile` or user's `~/.profile`, but variables that are not specific to command line interpreters are better put in `/etc/environment`, since those variables will be injected into all user sessions thanks to a Pluggable Authentication Module (PAM) even when no shell is executed.

```bash
# display
echo $PATH
echo $PWD
echo $HOME
echo $USER

echo "$$"   # process ID

# define variables
# available to any subprocesses spawn from current bash.
export all_proxy=socks5:127.0.0.1:1080

export address=10.11.1.120
ping -c 2 $address

# define variables
# only available in current shell
var="My Var"
echo "$$"
echo $var   # "My Var"

# new a bash and the process ID
bash
echo "$$"
echo $var   # Nonthing
exit

# default `env`
env
```

- To be always reminded of who you are and what machine you are on

```bash
echo $PS1
PS1="\u@\h \$ "
echo $PS1
```

### Customizing the Bash Environment

- [Shell 1 - Usage of .bashrc, .bash_alias, and .bash_profile](https://tane-rs.github.io/2019/11/14/00.html)

## Hard Links and Soft (Symbolic) Links

```bash
ln file1 file2      # Suppose that file1 already exists, a hard link, called file2, is created
ln -s file1 file3   # A soft link, file3 clearly points to file1 and has a different inode number
ls -li file?        # prints out in the first column the inode number

echo 'file1 content' > file1
cat file1
cat file2
cat file3

echo 'more content written in file2' >> file2
cat file1
cat file2
cat file3

echo 'more content written in file3' >> file2
cat file1
cat file2
cat file3

rm file1
ls -li file?
cat file2
cat file3
```

- Unlike hard links, soft links can point to objects even on different filesystems, partitions, and/or disks and other media, which may or may not be currently available or even exist. In the case where the link does not point to a currently available or existing object, you obtain a dangling link.

## Piping and Redirection

- Every program run from the command line has three data stream connected to it that serve as communication channels with the external environment. These streams are defined as:

  Stream Name | Description | Value
  -|-|-
  STDIN | Data fed into the program (usrally is keyboard) | file descriptor 0
  STDOUT | Output from the program (default to terminal) | file descriptor 1
  STDERR | Err messages (default to terminal) | file descriptor 2

- Piping: `|`

- Redirecting: `<` and `>`

```bash
## STDIN
# redirecting to new file
ls
echo "test"
echo "test" > redirection_test.txt
echo "test2" >> redirection_test.txt
echo "test3" 1>> redirection_test.txt  # syntax is the same as above
ls
cat redirection_test.txt
echo "Kali Linux is an open source project" > redirection_test.txt
cat redirection_test.txt

# redirecting to an existing file
echo "that is maintained and funded by Offensive Security" >> redirection_test.tx
cat redirection_test.txt

## STDOUT
# redirecting from a file
wc -m < redirection_test.txt
# redirection_test.txt is STDIN
# output (char count) is STDOUT

## STDERROR
ls ./not_exist 2>> error.txt          # 2: file descriptor
cat error.txt

ls ./not_exist > error.txt 2>&1
# A special shorthand notation can send anything written to file descriptor 2 (stderr)
# to the same place as file descriptor 1 (stdout)
cat error.txt

ls ./not_exist >& error.txt # an easier syntax for the above
cat error.txt

## Piping
cat error.txt | wc -m > count.txt
cat count.txt
```

## Command Line

### Text Terminal on the Graphical Desktop

- A terminal emulator program emulates (simulates) a standalone terminal within a window on the desktop.
- By default, on GNOME desktop environments, the gnome-terminal application is used to emulate a text-mode terminal in a window. Other available terminal programs include:
  - xterm
  - rxvt
  - konsole (default on KDE)
  - terminator

- Most input lines entered at the shell prompt have three basic elements:
  - Command
  - Options
  - Arguments
  - Other elements (such as setting environment variables)

### Virtual Terminals (GNOME Terminal)

- Virtual Terminals (VT) are console sessions that use the entire display and keyboard outside of a graphical environment;
- Such terminals are considered "virtual" because, although there can be multiple active terminals, only one terminal remains visible at a time.
- To switch between VTs, press `CTRL-ALT-function key` for the VT. For example, press `CTRL-ALT-F6` for 'VT 6'. Actually, you only have to press the `ALT-F6` key combination if you are in a VT and want to switch to another VT.
- One virtual terminal (usually number one or seven) is reserved for the graphical environment, and text logins are enabled on the unused VTs. Ubuntu uses 'VT 7', but CentOS/RHEL and openSUSE use 'VT 1' for the graphical display.

### Turning Off the Graphical Desktop

- For the newer systemd-based distributions, the display manager is run *as a service*, you can stop the GUI desktop with the systemctl utility and most distributions will also work with the `telinit` command, as in:

```bash
sudo systemctl stop <gdm|lightdm|kdm>
# OR
sudo telinit 3

sudo systemctl start <gdm|lightdm|kdm>
# OR
sudo telinit 5
```

- On Ubuntu versions before 18.04 LTS, substitute `lightdm` for `gdm`.

### `sudo`

- `sudo` allows users to run programs using the security privileges of another user, generally root (superuser). 

```bash
su    # enter sudo mode

# create the configuration file for 'student' under sudo mode
echo "student ALL=(ALL) ALL" > /etc/sudoers.d/student
chmod 440 /etc/sudoers.d/student
```

### Getting Help - `man`, `apropos`, `--help`, `info` and Others

- Manual: `man [pages]` Divided into chapters numbered 1 through 9:
  - User commands
  - Programming interfaces for kernel system calls
  - Programming interfaces to the C library
  - Special files such as device nodes and drivers
  - File formats
  - Miscellaneous
  - System administration commands

```bash
man ls
man passwd
man -k passwd       # -k: key word, will return section of a key word
man -k `^passwd$`
man 5 passwd        # 5: the section returned by above command
man -f passwd
man -a socket       # all pages with the given name in all chapters

apropos passwd      # equivalent to `man -k [pages]`
apropos partition

what is passwd      # equivalent to `man -f [pages]`
```

- GNU info: The topic which you view in an info page is called a node.
  - `n`: Go to the next node
  - `p`: Go to the previous node
  - `u`: Move one node up in the index

```bash
info make
```

- Help: `--help` is useful as a quick reference and it displays information faster than the `man` or `info` pages.

```bash
uname --help
```

### Other helps

- Graphical Help Systems
  - GNOME: `gnome-help` or `yelp`, it can be more detailed as `yelp man:cat`, then use `Ctrl + l` to shift to other commands.
  - KDE: `khelpcenter`

- Package Documentation
  - `/usr/share/doc`

- Online Resources

### Rebooting and Shutting Down

```bash
halt
poweroff
sudo shutdown -h 10:00 "Shutting down for scheduled maintenance."

reboot
sudo shutdown -r 10:00 "Reboot for scheduled maintenance."
```

- Note: On recent Wayland-based Linux distributions, broadcast messages do not appear on terminal emulation sessions running on the desktop; they appear only on the VT console displays.

### Other Useful Commands

- See [Linux 7 - Basic Operation For Debian-liked System](https://tane-rs.github.io/2019/10/29/00.html)
